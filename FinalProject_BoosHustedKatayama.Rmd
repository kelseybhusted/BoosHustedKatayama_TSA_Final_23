---
title: "Climate"
author: "Elise Boos, Kelsey Husted, Taro Katayama"
date: "2023-04-11"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Data

```{r cars}
require(tidyverse)
require(tseries)
require(forecast)
require(ggplot2)

temp <- read.csv("./Data_Raw/Temperature_Data.csv")
prec <- read.csv("./Data_Raw/Precipitation_Data.csv")
```

##Tidy data
```{r}
temp_processed<- temp%>%
  mutate(Date = as.Date(Date, format = "%d-%m-%y"))%>%
  rename(Temp= Temperaturedaily)%>%
  arrange(Date, Country)%>%
  select(Date, Country, Temp)

prec_processed<- prec%>%
  mutate(Date = as.Date(Date, format = "%d-%m-%y"))%>%
  rename(Precip= Precipitationdaily)%>%
  #arrange(Date)%>%
  select(Date, Country, Precip)
```

##Time series transformation (Brazil)
```{r}
#Filter for Brazil 
#Temperature
BRA_temp <- temp_processed%>%
  filter(Country == 'BRA')
#Precipitation
BRA_precip <- prec_processed%>%
  filter(Country == 'BRA')

#Time series transformation
ts_temp_BRA <- ts(BRA_temp[,3], frequency = 365, start = c(2000,1))
ts_precip_BRA <- ts(BRA_precip[,3], frequency = 365, start = c(2000,1))

#Decompose
decompose_temp_BRA <- decompose(ts_temp_BRA, type = "additive")
plot(decompose_temp_BRA)
decompose_precip_BRA <- decompose(ts_precip_BRA, type = "additive")
plot(decompose_precip_BRA)
```

##Time series transformation (USA)
```{r}
#Filter for USA
#Temperature
USA_temp <- temp_processed%>%
  filter(Country == 'USA')
#Precipitation
USA_precip <- prec_processed%>%
  filter(Country == 'USA')

#Time series transformation
ts_temp_USA <- ts(USA_temp[,3], frequency = 365, start = c(2000,1))
ts_precip_USA <- ts(USA_precip[,3], frequency = 365, start = c(2000,1))

#Decompose
decompose_temp_USA <- decompose(ts_temp_USA, type = "additive")
plot(decompose_temp_USA)
decompose_precip_USA <- decompose(ts_precip_USA, type = "additive")
plot(decompose_precip_USA)
```

```{r forecast}
#AUTO ARTIMA
arima <- auto.arima(ts_temp_BRA,seasonal=FALSE, 
                             lambda=0)
arima
checkresiduals(arima)

ARIMA_forecast <- forecast(arima,h=1825) 



#### NEURAL NETWORK 
NN_fit <- nnetar(ts_temp_BRA,p=1,P=1)

#5 year forecast
NN_for <- forecast(NN_fit, h=1825)



TBATS_fit <- tbats(ts_temp_BRA)

TBATS_for <- forecast(TBATS_fit, h=1825)




###PLOT
autoplot(ts_temp_BRA) +
  autolayer(NN_for, series="Neural Network",PI=FALSE)+
  autolayer(ARIMA_forecast, series="ARIMA",PI=FALSE)+
  autolayer(TBATS_for,series="TBATS",PI=FALSE) +
  ylab("Tempurature") 




```
