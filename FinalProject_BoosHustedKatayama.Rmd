---
title: "Climate"
author: "Elise Boos, Kelsey Husted, Taro Katayama"
date: "2023-04-11"
output: pdf_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Data

```{r cars}
require(tidyverse)
require(tseries)
require(forecast)
require(ggplot2)

temp <- read.csv("./Data_Raw/Temperature_Data.csv")
#prec <- read.csv("./Data_Raw/Precipitation_Data.csv")
```


##Tidy data

```{r}
temp_processed<- temp%>%
  mutate(Date = as.Date(Date, format = "%d-%m-%y"))%>%
  rename(Temp= Temperaturedaily)%>%
  arrange(Date, Country)%>%
  select(Date, Country, Temp)

# prec_processed<- prec%>%
#   mutate(Date = as.Date(Date, format = "%d-%m-%y"))%>%
#   rename(Precip= Precipitationdaily)%>%
#   #arrange(Date)%>%
#   select(Date, Country, Precip)
```


##Time series transformation (BRA)

```{r}
#Filter for Brazil 
#Temperature
BRA_temp <- temp_processed%>%
  filter(Country == 'BRA')
#Precipitation
# BRA_precip <- prec_processed%>%
#   filter(Country == 'BRA')


fday <- first(BRA_temp$Date)

#Time series transformation ts()
ts_temp_BRA <- ts(BRA_temp[,3], frequency = 365, start = c(year(fday), month(fday), day(fday)))
#ts_precip_BRA <- ts(BRA_precip[,3], frequency = 365, start = c(2000,1))

#Time series transformation msts()
ts_temp_BRA2 <- msts(BRA_temp[,3], seasonal.periods =c(7,365.25),
                           start=c(year(fday), month(fday), day(fday)))
# ts_precip_BRA2 <- msts(BRA_precip[,3], seasonal.periods =c(7,365.25),
#                            start=c(2000,01,01))

#Decompose
decompose_temp_BRA <- decompose(ts_temp_BRA, type = "additive")
plot(decompose_temp_BRA)
# decompose_precip_BRA <- decompose(ts_precip_BRA, type = "additive")
# plot(decompose_precip_BRA)
```


##Time series transformation (USA)

```{r}
#Filter for USA
#Temperature
USA_temp <- temp_processed%>%
  filter(Country == 'USA')
#Precipitation
# USA_precip <- prec_processed%>%
#   filter(Country == 'USA')

#Time series transformation
ts_temp_USA <- ts(USA_temp[,3], frequency = 365, start = c(2000,1))
# ts_precip_USA <- ts(USA_precip[,3], frequency = 365, start = c(2000,1))

#Decompose
decompose_temp_USA <- decompose(ts_temp_USA, type = "additive")
plot(decompose_temp_USA)
# decompose_precip_USA <- decompose(ts_precip_USA, type = "additive")
# plot(decompose_precip_USA)
```


##Time series transformation (AUS)

```{r}
#Filter for Australia
#Temperature
AUS_temp <- temp_processed%>%
  filter(Country == 'AUS')
#Precipitation
# AUS_precip <- prec_processed%>%
#   filter(Country == 'AUS')

#Time series transformation
ts_temp_AUS <- ts(AUS_temp[,3], frequency = 365, start = c(2000,1))
# ts_precip_AUS <- ts(AUS_precip[,3], frequency = 365, start = c(2000,1))

#Decompose
decompose_temp_AUS <- decompose(ts_temp_AUS, type = "additive")
plot(decompose_temp_AUS)
# decompose_precip_AUS <- decompose(ts_precip_AUS, type = "additive")
# plot(decompose_precip_AUS)
```

##Temperature Forecasting (BRA)
```{r forecast}
#AUTO ARTIMA
arima <- auto.arima(ts_temp_BRA,seasonal=FALSE, 
                             lambda=0)
arima
checkresiduals(arima)

ARIMA_forecast <- forecast(arima,h=365)

### ARIMA + Fourier Terms
ARIMA_Four <- auto.arima(ts_temp_BRA2,
                         seasonal=FALSE,
                         lambda=0,
                         xreg=fourier(ts_temp_BRA2,
                                      K=c(2,16)))
ARIMA_Four_for <- forecast(ARIMA_Four,
                           xreg=fourier(ts_temp_BRA2,
                                        K=c(2,16),
                                        h=365),
                           h=365)

#### NEURAL NETWORK 
NN_fit <- nnetar(ts_temp_BRA2,p=1,P=1)

#5 year forecast
NN_for <- forecast(NN_fit, h=365)


### TBATS
TBATS_fit <- tbats(ts_temp_BRA2)

TBATS_for <- forecast(TBATS_fit, h=365)

### STL + ETS
ETS_fit <- stlf(ts_temp_BRA2, h=365)


###PLOT
autoplot(window(ts_temp_BRA, start = c(2019,1))) +
  autolayer(NN_for, series="Neural Network",PI=FALSE)+
  autolayer(ARIMA_forecast, series="ARIMA",PI=FALSE)+
  autolayer(TBATS_for,series="TBATS",PI=FALSE)+
  autolayer(ETS_fit,series="STL + ETS",PI=FALSE)+
 # autolayer(ARIMA_Four_for, series="ARIMA_FOURIER",PI=FALSE)+
  ylab("Temperature") 

```
